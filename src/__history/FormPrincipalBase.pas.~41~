unit FormPrincipalBase;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, FireDAC.Stan.Intf,
  FireDAC.Stan.Option, FireDAC.Stan.Param, FireDAC.Stan.Error,
  FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf, FireDAC.Stan.Async,
  FireDAC.DApt, Data.DB, FireDAC.Comp.DataSet, FireDAC.Comp.Client, DataConexao,
  Vcl.ExtCtrls, Vcl.ComCtrls, Vcl.Buttons, Vcl.Imaging.pngimage, FrameConfiguracao;

type
  TPrincipalBase = class(TForm)
    fdqryDadosUser: TFDQuery;
    TelaConfig: TFrameConfig;
    Panel1: TPanel;
    Image1: TImage;
    lblNomeCompleto: TLabel;
    btnRelatorio: TSpeedButton;
    btnSair: TSpeedButton;
    btnConfiguracao: TSpeedButton;
    pnlTela: TPanel;
    procedure FormShow(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure btnConfiguracaoClick(Sender: TObject);
    procedure btnSairClick(Sender: TObject);
  private
    FUserId: Integer;
    procedure SetUserId(const Value: Integer);
    { Private declarations }
  public
    { Public declarations }
  published
    property UserId: Integer read FUserId write SetUserId;
  end;

var
  PrincipalBase: TPrincipalBase;

implementation

uses
  FormTelaLogin;

{$R *.dfm}

{ TPrincipalBase }

procedure TPrincipalBase.btnSairClick(Sender: TObject);
begin
  if Assigned(TelaConfig) then
  begin
    FreeAndNil(TelaConfig);
  end;

  TelaLogin.Show;

  // Fecha este formulário
  Close;
end;


procedure TPrincipalBase.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
    TelaLogin.Show;
end;

procedure TPrincipalBase.FormShow(Sender: TObject);
begin
    fdqryDadosUser.Close;
    fdqryDadosUser.ParamByName('USER_ID').AsInteger := UserId;
    fdqryDadosUser.Open;
end;

procedure TPrincipalBase.SetUserId(const Value: Integer);
begin
  FUserId := Value;
end;

procedure TPrincipalBase.btnConfiguracaoClick(Sender: TObject);
var
  FrameConfig: TFrame;
begin
  FrameConfig := TFrame(FindComponent('FrameCadastro'));

  if not Assigned(FrameConfig) then
  begin
    TelaConfig := TFrameConfig.Create(Self);
    TelaConfig.Name := 'FrameCadastro';
    TelaConfig.Parent := pnlTela;
    TelaConfig.Align := alClient;
  end
  else
  begin
    FrameConfig.Visible := True;
    FrameConfig.BringToFront;
  end;
  end;
end.
