unit FormPrincipalBase;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, FireDAC.Stan.Intf,
  FireDAC.Stan.Option, FireDAC.Stan.Param, FireDAC.Stan.Error,
  FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf, FireDAC.Stan.Async,
  FireDAC.DApt, Data.DB, FireDAC.Comp.DataSet, FireDAC.Comp.Client, DataConexao,
  Vcl.ExtCtrls, Vcl.ComCtrls, Vcl.Buttons, Vcl.Imaging.pngimage, FrameRelatorio, FrameConfiguracao;

type
  TPrincipalBase = class(TForm)
    fdqryDadosUser: TFDQuery;
    TelaConfig: TFrameConfig;
    Panel1: TPanel;
    btnSair: TSpeedButton;
    pnlTela: TPanel;
    Panel2: TPanel;
    btnConfiguracao: TSpeedButton;
    btnRelatorio: TSpeedButton;
    Panel3: TPanel;
    Image1: TImage;
    lblNomeCompleto: TLabel;
    procedure FormShow(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure btnConfiguracaoClick(Sender: TObject);
    procedure btnSairClick(Sender: TObject);
    procedure btnRelatorioClick(Sender: TObject);
  private
    FUserId: Integer;
    procedure SetUserId(const Value: Integer);
    { Private declarations }
  public
    { Public declarations }
  published
    property UserId: Integer read FUserId write SetUserId;
  end;

var
  PrincipalBase: TPrincipalBase;

implementation

uses
  FormTelaLogin;

{$R *.dfm}

{ TPrincipalBase }

procedure TPrincipalBase.btnRelatorioClick(Sender: TObject);
var
  FrameRelatorio: TFrame;
begin
  FrameRelatorio := TFrame(FindComponent('FrameCadastro'));

  if not Assigned(FrameRelatorio) then
  begin
    TelaConfig := FrameRelatorio.Create(Self);
    TelaConfig.Name := 'FrameRelatorio';
    TelaConfig.Parent := pnlTela;
    TelaConfig.Align := alClient;
  end
  else
  begin
    FrameRelatorio.Visible := True;
    FrameRelatorio.BringToFront;
  end;
  end;

procedure TPrincipalBase.btnSairClick(Sender: TObject);
begin
  if Assigned(TelaConfig) then
  begin
    FreeAndNil(TelaConfig);
  end;

   if Assigned(TelaConfig) then
  begin
    FreeAndNil(TelaConfig);
  end;

  TelaLogin.Show;
  Close;
end;


procedure TPrincipalBase.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
    TelaLogin.Show;
end;

procedure TPrincipalBase.FormShow(Sender: TObject);
begin
    fdqryDadosUser.Close;
    fdqryDadosUser.ParamByName('USER_ID').AsInteger := UserId;
    fdqryDadosUser.Open;
end;

procedure TPrincipalBase.SetUserId(const Value: Integer);
begin
  FUserId := Value;
end;

procedure TPrincipalBase.btnConfiguracaoClick(Sender: TObject);
var
  FrameConfig: TFrame;
begin
  FrameConfig := TFrame(FindComponent('FrameCadastro'));

  if not Assigned(FrameConfig) then
  begin
    TelaConfig := TFrameConfig.Create(Self);
    TelaConfig.Name := 'FrameCadastro';
    TelaConfig.Parent := pnlTela;
    TelaConfig.Align := alClient;
  end
  else
  begin
    FrameConfig.Visible := True;
    FrameConfig.BringToFront;
  end;
  end;
end.
